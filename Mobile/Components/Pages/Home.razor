@page "/"

@implements IFeedNotifier

<MudStack Spacing="0">
    <Header OrganizationList="OrganizationList" Notifier="this"></Header>
    <NewsFeeds MyOrganization="CurrentOrganization">
        <ProfileContent>
            <OrganizationView Organizaton="CurrentOrganization" AppStateService="_appStateService"></OrganizationView>
        </ProfileContent>
        <NewsFeedContent>
            <NewsFeedPosts @ref="PostComponentRef" OrganiationId="@CurrentOrganization?.MyOrganizationId" NewsFeedService="_newsFeedService"></NewsFeedPosts>
        </NewsFeedContent>
    </NewsFeeds>
</MudStack>
@code {

    List<MyOrganizationModel> OrganizationList = new();

    private MyOrganizationModel? CurrentOrganization;
    private List<NewsFeedModel> CurrentNewsFeeds = new();
    private NewsFeedPosts PostComponentRef = null!;

    public async Task OnOrganizationClick(Guid gui)
    {
        if(gui.Equals(new Guid()))
        {
            CurrentOrganization = null;
            PostComponentRef.filterPostsByOrganization(null, true);
        } 
        else
        {
            CurrentOrganization = OrganizationList.FirstOrDefault(x => x.MyOrganizationId == gui);
            PostComponentRef.filterPostsByOrganization(CurrentOrganization?.MyOrganizationId);

        }

        await InvokeAsync(StateHasChanged);
    }

    protected override async Task OnInitializedAsync()
    {
        // await base.OnInitializedAsync();

        OrganizationList = await _organizationService.GetAllOrganizationsAsync();

        StateHasChanged();

    }
}

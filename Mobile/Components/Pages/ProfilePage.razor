@page "/profile"

<ProfileComponent 
    Profile="_appStateService.CurrentUser.ProfileInformation" 
    Email="@_appStateService.CurrentUser.Email"
    CurrentFullname="@_appStateService.CurrentUser.Name"
    OnProfileChanged="UpdateProfile">
</ProfileComponent>

@code {

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        if (_appStateService.CurrentUser.ProfileInformation is null) return;

        if(string.IsNullOrEmpty(_appStateService.CurrentUser.ProfileInformation.FullName))
        {
            _appStateService.CurrentUser.ProfileInformation.FullName = _appStateService.CurrentUser.Name;
        };
    }

    private async Task UpdateProfile(ProfileInfo profile)
    {
        _appStateService.CurrentUser.ProfileInformation = await _profileService.UpdateProfile(profile);

        SnackBarHelper.ShowSnackbar("Profile successfully changed.", Variant.Filled, _snackBar, Severity.Success);

        _notifierLayoutService.NotifyChanged();

        StateHasChanged();
    }
}

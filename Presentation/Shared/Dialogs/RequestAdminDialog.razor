@using Domain;

<MudDialog>
    <TitleContent>
        Request Admin Page
    </TitleContent>
    <DialogContent>
        <MudStack Class="gap-2">
            <MudText Typo="Typo.caption">@Model?.User?.Name is requesting for a page admin of @Model?.OrganizationName</MudText>
            @foreach (var image in PageRequest.PageRequestImages ?? [])
            {
                <MudPaper Elevation="1" Class="pa-2">
                    <MudImage Src="@image.ImageUrl" Alt="Requested Image" Width="100%"></MudImage>
                </MudPaper>
            }
        </MudStack>
    </DialogContent>
    <DialogActions>
        <MudButton OnClick="Cancel">Cancel</MudButton>
        <MudButton Color="Color.Error" OnClick="() => Submit(Enums.PageRequestStatus.Rejected)" Variant="Variant.Text">Reject</MudButton>
        <MudButton Color="Color.Primary" OnClick="() => Submit(Enums.PageRequestStatus.Approved)" Variant="Variant.Filled">Approve</MudButton>
    </DialogActions>
</MudDialog>

@code {
    [CascadingParameter]
    private IMudDialogInstance MudDialog { get; set; }

    [Parameter] public AdminPageRequestModel Model { get; set; } = new();

    [Parameter] public Guid NotificationId { get; set; }

    private void Cancel() => MudDialog.Cancel();

    private AdminPageRequestModel PageRequest = new();

    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();

        PageRequest = await _pageRequestService.GetById(Model.AdminPageRequestId);
    }

    private async Task Submit(Enums.PageRequestStatus status)
    {
       
        Model.PageRequestStatus = status;

        await _pageRequestService.UpdatePageRequestAsync(Model, NotificationId);

        SnackBarHelper.ShowSnackbar($"Request has been {status.Humanize()}.", Variant.Filled, _snackBar, Severity.Success);

        MudDialog.Close(DialogResult.Ok(true));
    }
}